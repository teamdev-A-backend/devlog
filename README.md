# Online Chat Messenger
クライアント-サーバー間のTCP通信によってチャットルームを作成し、UDP通信によって同じ部屋に参加しているユーザー同士でメッセージを送信できるプログラムです。CLIから起動できます。

# 使用方法


<br />
<br />
<br />

# 議事録
# 9.25 Sat - 29 wen - 各自でステージ１に取り掛かる
<br />

ステージ１：クライアント->サーバーにUDP通信で送信したメッセージが全クライアントに共有される
<br/>



## 機能要件

- [ ]  local chat messengerとほぼ同じです。 

- [ ] セッションが開始される際には、クライアントはユーザーにユーザー名を入力させます。  

- [ ] メッセージの送信プロトコルは比較的シンプルです。メッセージの最初の1バイト、usernamelenは、ユーザー名の全バイトサイズを示し、これは最大で255バイト（2^8 - 1バイト）になります。サーバはこの初めのusernamelenバイトを読み、送信者のユーザー名を特定します。その後のバイトは送信される実際のメッセージです。この情報はサーバとクライアントによって自由に使用され、ユーザー名の表示や保存が可能です。

- [ ] バイトデータはUTF-8でエンコードおよびデコードされます。これは、1文字が1から4バイトで表現される意味です。Pythonのstr.encodeとstr.decodeメソッドは、デフォルトでこの挙動を持っています。 

- [ ] サーバにはリレーシステムが組み込まれており、現在接続中のすべてのクライアントの情報を一時的にメモリ上に保存します。新しいメッセージがサーバに届くと、そのメッセージは現在接続中の全クライアントにリレーされます。

- [ ] クライアントは、何回か連続で失敗するか、しばらくメッセージを送信していない場合、自動的にリレーシステムから削除されます。この点でTCPと異なり、UDPはコネクションレスであるため、各クライアントの最後のメッセージ送信時刻を追跡する必要があります。  


# 9.29 wen - - stage2に取り掛かる


ステージ2 : chat roomの作成/接続

<br/>

## 機能要件


1. チャットルームの作成と接続（TCP）

- [ ] カスタムTCPプロトコルを作成し、クライアントとサーバがチャットルームの作成と接続のために通信できるようにします。TCPは、メッセージの受信と順序が保証されるため、信頼性が高いです。以下は、チャットルームプロトコル（TCRP）と呼ぶカスタムプロトコルです。

- [ ] ヘッダー（32バイト）：RoomNameSize（1バイト） | Operation（1バイト） | State（1バイト） | OperationPayloadSize（29バイト）

- [ ] ボディ：最初のRoomNameSizeバイトがルーム名で、その後にOperationPayloadSizeバイトが続きます。ルーム名の最大バイト数は2^8バイトであり、OperationPayloadSizeの最大バイト数は2^29バイトです。

- [ ] RoomNamesはUTF-8でエンコード/デコードされます。OperationPayloadは、操作と状態に応じて異なる方法でデコードされる可能性があります（整数、文字列、JSONファイルなど）

- [ ] 新しいチャットルームを作成する場合、操作コードは1です。0はリクエスト、1は準拠、2は完了です。TCPは完全なトランザクションを保証するために使用されます。

- [ ] サーバの初期化（0）：クライアントが新しいチャットルームを作成するリクエストを送信します。ペイロードには希望するユーザー名が含まれます。

- [ ] リクエストの応答（1）：サーバはステータスコードを含むペイロードで即座に応答します。

- [ ] リクエストの完了（2）：サーバは特定の生成されたユニークなトークンをクライアントに送り、このトークンにユーザー名を割り当てます。このトークンはクライアントをチャットルームのホストとして識別します。トークンは最大255バイトです。

- [ ] 新しいチャットルームに参加しようとするとき、操作コードは2です。状態は作成時と同様で、クライアントも生成されたトークンを受け取りますが、ホストではありません。

- [ ] チャットルームごとに、サーバは許可されたリストトークンのリストを追跡する必要があります。ユーザーがそのトークンで参加すると、トークンの所有者として設定されます。メッセージがチャットルーム内の他のすべての人にリレーされるためには、トークンとIPアドレスが一致しなければなりません。

- [ ] チャットルームの作成またはチャットルームへの参加が完了すると、TCPコネクションは終了します。クライアントは自動的にUDPでサーバに接続します。

2. ルームでのチャット（UDP）

- [ ] チャットルームはホストが存在する限り有効です。ホストが退出すると、チャットルームは自動的に閉じられます。

- [ ] チャットルームに参加するには、専用の許可トークンが必要です。このトークンは参加者のIPアドレスと一致する必要があります。

- [ ] クライアントとサーバ間でのメッセージ交換は、すべてUDPプロトコルを使用して行われます。

- [ ] クライアントがサーバに送信するパケットは、最大4096バイトのメッセージとなります。そのうちの最初の2バイトは、ルーム名とトークンのバイトサイズを示しています。

- [ ] ヘッダー：RoomNameSize（1バイト）| TokenSize（1バイト）

- [ ] ボディ：最初のRoomNameSizeバイトはルーム名、次のTokenSizeバイトはトークン文字列、そしてその残りが実際のメッセージです。

- [ ] クライアントはサーバから最大で4094バイトのパケットを受信できます。これはメッセージのみで、ヘッダーは含まれません。
クライアントがリレーシステムから削除された場合、そのトークンもサーバから削除されます。サーバは切断メッセージを該当のクライアントに転送します。その後、クライアントは再度チャットルームに参加する必要があります。




